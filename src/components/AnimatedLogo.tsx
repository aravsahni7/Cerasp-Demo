import { useEffect, useState } from "react";
import { motion, Easing, useReducedMotion } from "framer-motion";

const easeOut: Easing = [0.25, 0.46, 0.45, 0.94];

/**
 * CERASP logo paths from cerasp.svg - All outline strokes
 */
const CERASP_PATHS: string[] = [
  "M0 0 C18.28046509 15.83266885 31.44709695 37.42681111 33.50004578 61.92556763 C33.65810058 64.48368989 33.77834877 67.04067584 33.8828125 69.6015625 C33.94492165 71.11888977 33.94492165 71.11888977 34.00828552 72.66687012 C34.59540104 89.24201573 34.42212684 105.83769278 34.38116455 122.42041016 C34.37076703 127.0875604 34.36633245 131.75471641 34.36132812 136.421875 C34.3507383 145.51043135 34.3337678 154.59896279 34.3125 163.6875 C35.55483398 163.69336624 36.79716797 163.69923248 38.07714844 163.70527649 C49.84520422 163.76275086 61.61307959 163.83563938 73.38095093 163.92321491 C79.42940919 163.96774259 85.4778028 164.00703661 91.52636719 164.03393555 C97.37501393 164.06014522 103.22340954 164.10066981 109.07189941 164.15068626 C111.29151256 164.1672364 113.51116903 164.17882381 115.73083496 164.18511391 C147.3404439 164.28366157 171.4553085 171.38780818 194.5625 193.625 C211.55379938 211.09946429 219.74253141 233.89073163 219.625 258 C219.62008545 259.19189941 219.6151709 260.38379883 219.61010742 261.61181641 C219.49798201 270.02409748 218.93473983 277.64175209 216.3125 285.6875 C215.96058594 286.77546875 215.60867188 287.8634375 215.24609375 288.984375 C206.82423089 312.66565275 189.38946639 331.46661306 167.25 343 C144.08383123 354.00393017 116.41671724 355.44043393 92.18115234 346.93994141 C68.11755835 337.9882185 49.69125995 319.18261218 38.5625 296.3125 C33.31921933 284.23169792 31.14827518 271.62447929 31.19897461 258.52954102 C31.19882858 257.53365463 31.19868256 256.53776825 31.1985321 255.51170349 C31.19922567 252.23824849 31.20699195 248.96485124 31.21484375 245.69140625 C31.21670991 243.41454601 31.21813288 241.13768537 31.21913147 238.86082458 C31.22294108 232.88171267 31.23275805 226.90262523 31.24383545 220.92352295 C31.25408306 214.81685721 31.25863626 208.7101875 31.26367188 202.60351562 C31.27438174 190.63149969 31.29143943 178.65950189 31.3125 166.6875 C30.70861293 166.71787479 30.10472586 166.74824959 29.48253918 166.77954483 C16.50193653 167.4203014 3.57717859 167.83600166 -9.41796875 167.671875 C-10.99628037 167.65506411 -12.57459362 167.63840559 -14.15290833 167.62188721 C-17.4154076 167.5860033 -20.67779204 167.54491565 -23.94018555 167.50048828 C-27.23540884 167.45633652 -30.53050983 167.42176123 -33.82592773 167.39599609 C-79.47911945 167.03441405 -79.47911945 167.03441405 -95.75 160.4375 C-96.92598755 159.97863403 -96.92598755 159.97863403 -98.12573242 159.51049805 C-104.50856851 156.93450406 -110.21939185 153.90050146 -115.6875 149.6875 C-116.23212891 149.26871582 -116.77675781 148.84993164 -117.33789062 148.41845703 C-137.50114352 132.67355751 -150.95066149 110.86092611 -154.37109375 85.25390625 C-156.70713283 58.92299667 -150.99374116 32.92504083 -133.8984375 12.2109375 C-100.22914304 -26.63305641 -40.07267332 -33.55707577 0 0 Z",
  "M70 0 C71.35585284 0.00081715 71.35585284 0.00081715 72.73909664 0.00165081 C73.77534176 -0.00254368 74.81158688 -0.00673817 75.87923336 -0.01105976 C77.0206126 -0.00544025 78.16199184 0.00017925 79.33795834 0.00596905 C80.53633327 0.0040707 81.73470821 0.00217236 82.96939754 0.00021648 C86.26065672 -0.00285937 89.5516661 0.00303135 92.84289575 0.01316953 C96.28175442 0.02193786 99.72060871 0.02019283 103.15947628 0.01980877 C108.9339999 0.02074586 114.70847103 0.02943649 120.48297787 0.04307842 C127.16767528 0.05881186 133.85231521 0.0640763 140.5370298 0.06334287 C146.95815269 0.06273341 153.37925678 0.06783088 159.80037403 0.07613468 C162.53760519 0.07967329 165.27482969 0.08149875 168.01206303 0.08202839 C171.82904897 0.08321557 175.64598666 0.09291204 179.46295834 0.1036253 C180.60636181 0.10317211 181.74976528 0.10271893 182.92781734 0.10225201 C184.47795528 0.10864948 184.47795528 0.10864948 186.05940914 0.1151762 C187.41469644 0.11768997 187.41469644 0.11768997 188.79736328 0.12025452 C190.83576107 0.24888897 190.83576107 0.24888897 191.83576107 1.24888897 C191.93179129 2.86845237 191.95763962 4.4922198 191.95601559 6.11462688 C191.95807758 7.69434277 191.95807758 7.69434277 191.96018124 9.3059721 C191.95478832 11.05384266 191.95478832 11.05384266 191.94928646 12.83702374 C191.94943249 14.05636608 191.94957851 15.27570843 191.94972897 16.53200054 C191.94915 19.88516408 191.94412075 23.23826671 191.93715501 26.59141946 C191.9309209 30.09214459 191.93031763 33.59287045 191.9291296 37.09360027 C191.92601645 43.72698553 191.91780329 50.36035438 191.90778011 56.99373239 C191.89661846 64.54379104 191.89110839 72.09385046 191.88608468 79.6439153 C191.87562066 95.17891603 191.85802154 110.71390039 191.83576107 126.24888897 C175.55505804 126.27221799 159.2743604 126.28986816 142.99364471 126.30070114 C135.43474488 126.30586409 127.87585542 126.31290677 120.31696224 126.32432842 C113.73096441 126.33427529 107.14497409 126.3407424 100.55896896 126.34297746 C97.06963036 126.34428457 93.58031323 126.34737039 90.09098148 126.35461903 C86.20194875 126.36263295 82.31293729 126.36288011 78.42389584 126.36241436 C77.2586488 126.36600964 76.09340176 126.36960491 74.8928442 126.37330914 C73.31312832 126.37124714 73.31312832 126.37124714 71.70149899 126.36914349 C70.3201922 126.37052618 70.3201922 126.37052618 68.91098022 126.3719368 C66.83576107 126.24888897 66.83576107 126.24888897 65.83576107 125.24888897 C65.73544962 123.65930987 65.70500249 122.06527536 65.7020483 120.47253704 C65.69778332 119.43911175 65.69351833 118.40568645 65.68912411 117.34094524 C65.68957729 116.19754177 65.69003048 115.0541383 65.6904974 113.87608624 C65.68713879 112.67946362 65.68378017 111.482841 65.68031979 110.24995708 C65.67242408 106.95864536 65.66914085 103.66739669 65.668504 100.3760798 C65.66755649 97.63241294 65.66388002 94.88875218 65.6603319 92.14508766 C65.65217982 85.67406974 65.64974835 79.20306573 65.65045834 72.73204327 C65.65105931 66.0479344 65.64050544 59.36390619 65.62471467 52.67981774 C65.61165646 46.94902431 65.60627371 41.21825731 65.60691375 35.48744911 C65.60716925 32.06123139 65.60428963 28.63508529 65.59373569 25.20888233 C65.58229281 21.38958464 65.58679098 17.57039832 65.59284115 13.75108624 C65.58722164 12.60970699 65.58160213 11.46832775 65.57581234 10.29236126 C65.58000683 9.25611614 65.58420132 8.21987103 65.58852291 7.15222454 C65.58797814 6.24832265 65.58743338 5.34442076 65.5868721 4.4131279 C65.9405026 1.33809856 66.92497066 0.35363049 70 0 Z",
  "M-30 220 C-15.83796041 232.13297544 -7.25586258 248.5045878 -5.74609375 267.1328125 C-5.1146907 285.01577638 -10.67076503 301.741267 -22.3984375 315.33203125 C-35.22143879 328.48234638 -50.99919008 335.99045185 -69.53369141 336.43115234 C-88.42121517 336.47741913 -104.43815882 331.09696153 -118.359375 317.83203125 C-131.35749077 303.89174437 -137.55572296 287.84502467 -137.25 268.87109375 C-136.09706094 251.01855301 -128.97693895 234.99816448 -115.9765625 222.62109375 C-111.93347578 219.30512342 -107.51145843 216.6256819 -103 214 C-102.30777344 213.59652344 -101.61554688 213.19304687 -100.90234375 212.77734375 C-78.36025628 200.60369076 -50.00094689 205.08500818 -30 220 Z ",
];

/* =========================
   SEQUENTIAL PATH DRAWING
========================= */
function SequentialBeamPath({
  d,
  pathIndex,
  totalPaths,
  totalDuration,
}: {
  d: string;
  pathIndex: number;
  totalPaths: number;
  totalDuration: number;
}) {
  const pathDuration = totalDuration / totalPaths;
  const startDelay = pathIndex * pathDuration;

  return (
    <motion.path
      d={d}
      pathLength={1}
      fill="none"
      stroke="url(#neonBlue)"
      strokeWidth={4}
      strokeLinecap="round"
      strokeLinejoin="round"
      filter="url(#beamGlow)"
      initial={{ pathLength: 0, opacity: 0 }}
      animate={{ pathLength: 1, opacity: 1 }}
      transition={{
        pathLength: {
          duration: pathDuration,
          delay: startDelay,
          ease: easeOut,
        },
        opacity: {
          duration: 0.3,
          delay: startDelay,
        },
      }}
    />
  );
}

/* =========================
   FINAL OUTLINE DRAW
========================= */
function OutlineOnPath({
  d,
  delay,
}: {
  d: string;
  delay: number;
}) {
  return (
    <>
      {/* glow pass */}
      <motion.path
        d={d}
        pathLength={1}
        fill="none"
        stroke="url(#neonBlue)"
        strokeWidth={6}
        opacity={0.28}
        filter="url(#beamGlow)"
        initial={{ pathLength: 0 }}
        animate={{ pathLength: 1 }}
        transition={{ duration: 1.1, delay, ease: easeOut }}
      />
      {/* crisp pass */}
      <motion.path
        d={d}
        pathLength={1}
        fill="none"
        stroke="url(#neonBlue)"
        strokeWidth={2.5}
        initial={{ pathLength: 0 }}
        animate={{ pathLength: 1 }}
        transition={{ duration: 1.1, delay, ease: easeOut }}
      />
    </>
  );
}

/* =========================
   MAIN COMPONENT
========================= */
const AnimatedCeraspLogo = () => {
  const reduceMotion = useReducedMotion();
  const [showOutline, setShowOutline] = useState(false);

  useEffect(() => {
    if (reduceMotion) {
      setShowOutline(true);
      return;
    }
    const t = setTimeout(() => setShowOutline(true), 3300); // 3 paths Ã— 1.1s each
    return () => clearTimeout(t);
  }, [reduceMotion]);

  return (
    <div className="relative w-full h-screen flex items-center justify-center overflow-hidden" style={{ backgroundColor: "hsl(210, 20%, 98%)" }}>
      <svg viewBox="-175 0 400 400" className="w-full h-full max-w-6xl max-h-screen">
        <defs>
          <linearGradient id="neonBlue" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="#3B82F6" />
            <stop offset="50%" stopColor="#60A5FA" />
            <stop offset="100%" stopColor="#3B82F6" />
          </linearGradient>

          <filter id="beamGlow" x="-80%" y="-80%" width="260%" height="260%">
            <feGaussianBlur stdDeviation="4" />
            <feMerge>
              <feMergeNode />
              <feMergeNode in="SourceGraphic" />
            </feMerge>
          </filter>
        </defs>

        {/* Sequential drawing animation */}
        {!reduceMotion && (
          <>
            {CERASP_PATHS.map((d, i) => (
              <SequentialBeamPath
                key={`draw-${i}`}
                d={d}
                pathIndex={i}
                totalPaths={CERASP_PATHS.length}
                totalDuration={3.3}
              />
            ))}
          </>
        )}

        {/* Final outline */}
        {(showOutline || reduceMotion) &&
          CERASP_PATHS.map((d, i) => (
            <OutlineOnPath
              key={`outline-${i}`}
              d={d}
              delay={i * 0.04}
            />
          ))}
      </svg>
    </div>
  );
};

export default AnimatedCeraspLogo;
